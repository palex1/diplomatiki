import streamlit as st
from google import genai
import os
import time  # <--- Î¤ÎŸ Î Î¡ÎŸÎ£Î˜Î•Î£Î‘ÎœÎ• Î“Î™Î‘ ÎÎ‘ ÎšÎ‘ÎÎŸÎ¥ÎœÎ• Î Î‘Î¥Î£Î•Î™Î£

# ----------------------------------------------------
# 1. Î”Î¹Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ· & Setup
# ----------------------------------------------------
st.set_page_config(page_title="Î•ÎºÏ€Î±Î¹Î´ÎµÏ…Ï„Î¹ÎºÏŒÏ‚ Î£Ï‡ÎµÎ´Î¹Î±ÏƒÏ„Î®Ï‚", layout="wide")

# --- Î£Î—ÎœÎ•Î™ÎŸ Î Î¡ÎŸÎ£ÎŸÎ§Î—Î£: Î’Î‘Î›Î• Î¤ÎŸ ÎšÎ›Î•Î™Î”Î™ Î£ÎŸÎ¥ Î•Î”Î© ---
GEMINI_API_KEY = os.getenv("GEMINI_API_KEY")
# ------------------------------------------------

if not GEMINI_API_KEY:
    st.error("Î›ÎµÎ¯Ï€ÎµÎ¹ Ï„Î¿ API Key.")
    client = None
else:
    client = genai.Client(api_key=GEMINI_API_KEY)

# ----------------------------------------------------
# 2. Sidebar
# ----------------------------------------------------
with st.sidebar:
    st.header("âš™ï¸ Î Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿Î¹ ÎœÎ±Î¸Î®Î¼Î±Ï„Î¿Ï‚")
    subject_area = st.text_input("Î˜Î­Î¼Î± ÎœÎ±Î¸Î®Î¼Î±Ï„Î¿Ï‚:", value="Î”Î¿Î¼Î­Ï‚ Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½")
    grade = st.selectbox("Î¤Î¬Î¾Î·:", ["Î“' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…", "Î‘' Î›Ï…ÎºÎµÎ¯Î¿Ï…", "Î’' Î›Ï…ÎºÎµÎ¯Î¿Ï…", "Î“' Î›Ï…ÎºÎµÎ¯Î¿Ï…", "Î•Î Î‘Î›"])
    duration = st.selectbox("Î”Î¹Î¬ÏÎºÎµÎ¹Î±:", ["45 Î»ÎµÏ€Ï„Î¬", "90 Î»ÎµÏ€Ï„Î¬"])
    method = st.selectbox("ÎœÎ­Î¸Î¿Î´Î¿Ï‚:", ["Î”Î¹ÎµÏÎµÏ…Î½Î·Ï„Î¹ÎºÎ®", "Project-Based", "Î‘Î½Ï„ÎµÏƒÏ„ÏÎ±Î¼Î¼Î­Î½Î· Î¤Î¬Î¾Î·"])
    st.divider()
    submit_btn = st.button("ðŸš€ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î¥Î»Î¹ÎºÎ¿Ï")

# ----------------------------------------------------
# 3. ÎšÏÏÎ¹Î¿ ÎœÎ­ÏÎ¿Ï‚
# ----------------------------------------------------
st.title("ðŸŽ“ Î£Ï‡ÎµÎ´Î¹Î±ÏƒÏ„Î®Ï‚ Î•ÎºÏ€Î±Î¹Î´ÎµÏ…Ï„Î¹ÎºÎ¿Ï Î¥Î»Î¹ÎºÎ¿Ï")
st.markdown(f"Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï…Î»Î¹ÎºÎ¿Ï Î³Î¹Î±: **{subject_area}** ({grade})")

# ÎŸÏÎ¯Î¶Î¿Ï…Î¼Îµ Ï„Î¿ Î¼Î¿Î½Ï„Î­Î»Î¿ ÏƒÎµ 1.5 flash Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Ï€Î¹Î¿ ÏƒÏ„Î±Î¸ÎµÏÏŒ ÏƒÏ„Î¿ free tier
MODEL_NAME = 'gemini-2.5-flash' 

if submit_btn and client:
    tab1, tab2, tab3 = st.tabs(["ðŸ“˜ Î”Î¹Î´Î±ÎºÏ„Î¹ÎºÏŒ Î£ÎµÎ½Î¬ÏÎ¹Î¿", "ðŸ“ Î¦ÏÎ»Î»Î¿ Î•ÏÎ³Î±ÏƒÎ¯Î±Ï‚", "âœ… ÎšÎ¿Ï…Î¯Î¶ Î‘Î¾Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ·Ï‚"])

    # -------------------------------------------
    # TAB 1: Î”Î¹Î´Î±ÎºÏ„Î¹ÎºÏŒ Î£ÎµÎ½Î¬ÏÎ¹Î¿
    # -------------------------------------------
    with tab1:
        st.subheader("Î‘Î½Î±Î»Ï…Ï„Î¹ÎºÏŒ Î”Î¹Î´Î±ÎºÏ„Î¹ÎºÏŒ Î£ÎµÎ½Î¬ÏÎ¹Î¿")
        with st.spinner("Î£Ï‡ÎµÎ´Î¹Î±ÏƒÎ¼ÏŒÏ‚ ÏƒÎµÎ½Î±ÏÎ¯Î¿Ï…..."):
            prompt_scenario = (
                f"Î”ÏÎ¬ÏƒÎµ Ï‰Ï‚ Î­Î¼Ï€ÎµÎ¹ÏÎ¿Ï‚ ÎµÎºÏ€Î±Î¹Î´ÎµÏ…Ï„Î¹ÎºÏŒÏ‚ Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÎºÎ®Ï‚. Î”Î·Î¼Î¹Î¿ÏÏÎ³Î·ÏƒÎµ Î­Î½Î± Î±Î½Î±Î»Ï…Ï„Î¹ÎºÏŒ Î´Î¹Î´Î±ÎºÏ„Î¹ÎºÏŒ ÏƒÎµÎ½Î¬ÏÎ¹Î¿ "
                f"Î³Î¹Î± Ï„Î¿ Î¸Î­Î¼Î± '{subject_area}' ÏƒÏ„Î·Î½ Ï„Î¬Î¾Î· '{grade}', Î´Î¹Î¬ÏÎºÎµÎ¹Î±Ï‚ {duration}. "
                f"ÎœÎ­Î¸Î¿Î´Î¿Ï‚: {method}. "
                "Î Î±ÏÎ¿Ï…ÏƒÎ¯Î±ÏƒÎµ Ï„Î· ÏÎ¿Î® Ï„Î¿Ï… Î¼Î±Î¸Î®Î¼Î±Ï„Î¿Ï‚ ÏƒÎµ Î¼Î¿ÏÏ†Î® Ï€Î¯Î½Î±ÎºÎ± Markdown."
            )
            try:
                response_1 = client.models.generate_content(model=MODEL_NAME, contents=prompt_scenario)
                st.markdown(response_1.text)
            except Exception as e:
                st.error(f"Î£Ï†Î¬Î»Î¼Î± ÏƒÏ„Î¿ Tab 1: {e}")

    # ÎœÎ¹ÎºÏÎ® Ï€Î±ÏÏƒÎ· 2 Î´ÎµÏ…Ï„ÎµÏÎ¿Î»Î­Ï€Ï„Ï‰Î½ Î³Î¹Î± Î½Î± Î¼Î·Î½ Î¼Ï€Î»Î¿ÎºÎ¬ÏÎµÎ¹ Ï„Î¿ API
    time.sleep(2) 

    # -------------------------------------------
    # TAB 2: Î¦ÏÎ»Î»Î¿ Î•ÏÎ³Î±ÏƒÎ¯Î±Ï‚
    # -------------------------------------------
    with tab2:
        st.subheader("Î¦ÏÎ»Î»Î¿ Î•ÏÎ³Î±ÏƒÎ¯Î±Ï‚ ÎœÎ±Î¸Î·Ï„Î®")
        with st.spinner("Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î±ÏƒÎºÎ®ÏƒÎµÏ‰Î½... (Î ÎµÏÎ¹Î¼Î­Î½ÎµÏ„Îµ Î»Î¯Î³Î¿)"):
            prompt_worksheet = (
                f"Î“Î¹Î± Ï„Î¿ Î¼Î¬Î¸Î·Î¼Î± '{subject_area}' ({grade}), Ï†Ï„Î¹Î¬Î¾Îµ Î­Î½Î± Î¦ÏÎ»Î»Î¿ Î•ÏÎ³Î±ÏƒÎ¯Î±Ï‚. "
                "ÎÎ± Î­Ï‡ÎµÎ¹: Î˜ÎµÏ‰ÏÎ¯Î±, 2 Î‘ÏƒÎºÎ®ÏƒÎµÎ¹Ï‚ ÎºÎ±Î¹ 1 Î”ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î± ÎšÏÎ¹Ï„Î¹ÎºÎ®Ï‚ Î£ÎºÎ­ÏˆÎ·Ï‚."
            )
            try:
                response_2 = client.models.generate_content(model=MODEL_NAME, contents=prompt_worksheet)
                st.markdown(response_2.text)
            except Exception as e:
                st.error(f"Î£Ï†Î¬Î»Î¼Î± ÏƒÏ„Î¿ Tab 2: {e}")

    # ÎœÎ¹ÎºÏÎ® Ï€Î±ÏÏƒÎ· 2 Î´ÎµÏ…Ï„ÎµÏÎ¿Î»Î­Ï€Ï„Ï‰Î½
    time.sleep(2)

    # -------------------------------------------
    # TAB 3: ÎšÎ¿Ï…Î¯Î¶ Î‘Î¾Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ·Ï‚
    # -------------------------------------------
    with tab3:
        st.subheader("Î¤ÎµÏƒÏ„ Î“Î½ÏŽÏƒÎµÏ‰Î½")
        with st.spinner("Î£ÏÎ½Ï„Î±Î¾Î· ÎµÏÏ‰Ï„Î®ÏƒÎµÏ‰Î½... (Î ÎµÏÎ¹Î¼Î­Î½ÎµÏ„Îµ Î»Î¯Î³Î¿)"):
            prompt_quiz = (
                f"Î¦Ï„Î¹Î¬Î¾Îµ Î­Î½Î± Quiz 5 ÎµÏÏ‰Ï„Î®ÏƒÎµÏ‰Î½ Ï€Î¿Î»Î»Î±Ï€Î»Î®Ï‚ ÎµÏ€Î¹Î»Î¿Î³Î®Ï‚ Î³Î¹Î± Ï„Î¿ '{subject_area}'. "
                "Î£Ï„Î¿ Ï„Î­Î»Î¿Ï‚ Î²Î¬Î»Îµ Ï„Î¹Ï‚ Î»ÏÏƒÎµÎ¹Ï‚."
            )
            try:
                response_3 = client.models.generate_content(model=MODEL_NAME, contents=prompt_quiz)
                st.markdown(response_3.text)
            except Exception as e:
                st.error(f"Î£Ï†Î¬Î»Î¼Î± ÏƒÏ„Î¿ Tab 3: {e}")

else:
    if not submit_btn:

        st.info("ðŸ‘ˆ Î Î±Ï„Î®ÏƒÏ„Îµ 'Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î¥Î»Î¹ÎºÎ¿Ï' Î³Î¹Î± Î½Î± Î¾ÎµÎºÎ¹Î½Î®ÏƒÎµÏ„Îµ.")


